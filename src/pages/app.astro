---
import Layout from '../layouts/Layout.astro';
import Header from '../components/shared/Header.astro';
import Footer from '../components/shared/Footer.astro';
import ImageUploadArea from '../components/app/ImageUploadArea.astro';
import ProcessingControls from '../components/app/ProcessingControls.astro';
import ImagePreview from '../components/app/ImagePreview.astro';
import DownloadButton from '../components/app/DownloadButton.astro';
---

<Layout title="Reshrimp - Image Processing App">
  <main class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-6xl mx-auto">
      <!-- Header -->
      <Header currentPath="/app" />

      <!-- App Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Image Processor</h1>
        <p class="text-gray-600">
          All processing happens on your device. Your images never leave your computer.
        </p>
      </div>

      <!-- Main Content -->
      <div class="space-y-8">
        <!-- Upload Area -->
        <section>
          <ImageUploadArea />
        </section>

        <!-- Processing Controls -->
        <section>
          <ProcessingControls />
        </section>

        <!-- Preview -->
        <section>
          <ImagePreview />
        </section>

        <!-- Download Button -->
        <section>
          <DownloadButton />
        </section>
      </div>

      <!-- Footer -->
      <Footer />
    </div>
  </main>
</Layout>

<script>
  import { ImageProcessorController } from '../lib/imageProcessor';

  // Initialize the controller when the DOM is ready
  let controller: ImageProcessorController;

  function init() {
    controller = new ImageProcessorController();
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

  // Cleanup on page unload to prevent memory leaks
  window.addEventListener('beforeunload', () => {
    controller?.cleanup();
  });
</script>
